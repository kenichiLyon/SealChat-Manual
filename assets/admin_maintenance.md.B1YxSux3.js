import{_ as a,o as i,c as n,ag as e}from"./chunks/framework.9PtxzSVj.js";const c=JSON.parse('{"title":"监控与维护","description":"系统状态监控、日志查看与常见故障处理","frontmatter":{"title":"监控与维护","description":"系统状态监控、日志查看与常见故障处理"},"headers":[],"relativePath":"admin/maintenance.md","filePath":"admin/maintenance.md","lastUpdated":1770388790000}'),t={name:"admin/maintenance.md"};function l(p,s,h,r,d,k){return i(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="监控与维护" tabindex="-1">监控与维护 <a class="header-anchor" href="#监控与维护" aria-label="Permalink to &quot;监控与维护&quot;">​</a></h1><h2 id="系统状态" tabindex="-1">系统状态 <a class="header-anchor" href="#系统状态" aria-label="Permalink to &quot;系统状态&quot;">​</a></h2><h3 id="系统状态页面" tabindex="-1">系统状态页面 <a class="header-anchor" href="#系统状态页面" aria-label="Permalink to &quot;系统状态页面&quot;">​</a></h3><p>访问 <code>/status</code> 查看：</p><table tabindex="0"><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>在线用户数</td><td>当前连接的用户数量</td></tr><tr><td>WebSocket 连接数</td><td>当前活跃的 WebSocket 连接</td></tr><tr><td>消息速率</td><td>每分钟消息发送量</td></tr><tr><td>数据库大小</td><td>SQLite 数据库文件大小</td></tr></tbody></table><h3 id="服务状态看板" tabindex="-1">服务状态看板 <a class="header-anchor" href="#服务状态看板" aria-label="Permalink to &quot;服务状态看板&quot;">​</a></h3><p>管理后台的状态看板提供实时监控：</p><ul><li>并发连接、在线用户、消息吞吐</li><li>世界/频道/私聊数量</li><li>附件数量与占用空间</li><li>支持近 1 小时 / 24 小时 / 7 天历史曲线</li></ul><h3 id="健康检查" tabindex="-1">健康检查 <a class="header-anchor" href="#健康检查" aria-label="Permalink to &quot;健康检查&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3212/status/health</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>返回：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;uptime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;24h30m&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="日志查看" tabindex="-1">日志查看 <a class="header-anchor" href="#日志查看" aria-label="Permalink to &quot;日志查看&quot;">​</a></h3><p><strong>Docker 部署</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sealchat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sealchat</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 实时查看</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>二进制部署</strong>： 日志输出到标准输出，可以重定向到文件：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./sealchat_server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sealchat.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="数据库维护" tabindex="-1">数据库维护 <a class="header-anchor" href="#数据库维护" aria-label="Permalink to &quot;数据库维护&quot;">​</a></h2><p><strong>备份 SQLite 数据库</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止服务后复制</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./data/chat.db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./backup/chat_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.db</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或使用 SQLite 命令（无需停止服务）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlite3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./data/chat.db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.backup &#39;./backup/chat_backup.db&#39;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>优化数据库</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlite3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./data/chat.db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;VACUUM;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlite3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./data/chat.db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ANALYZE;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h2 id="常见管理任务" tabindex="-1">常见管理任务 <a class="header-anchor" href="#常见管理任务" aria-label="Permalink to &quot;常见管理任务&quot;">​</a></h2><h3 id="重置用户密码" tabindex="-1">重置用户密码 <a class="header-anchor" href="#重置用户密码" aria-label="Permalink to &quot;重置用户密码&quot;">​</a></h3><ol><li>进入管理后台 → 用户管理</li><li>找到用户</li><li>点击&quot;重置密码&quot;</li><li>输入新密码</li><li>通知用户新密码</li></ol><h3 id="处理违规内容" tabindex="-1">处理违规内容 <a class="header-anchor" href="#处理违规内容" aria-label="Permalink to &quot;处理违规内容&quot;">​</a></h3><ol><li>在消息上右键 → 删除</li><li>或进入管理后台批量处理</li><li>记录处理原因</li></ol><h3 id="处理存储空间不足" tabindex="-1">处理存储空间不足 <a class="header-anchor" href="#处理存储空间不足" aria-label="Permalink to &quot;处理存储空间不足&quot;">​</a></h3><ol><li><p>检查大文件：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">du</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./sealchat-data/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">du</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./static/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>清理过期的导出文件</p></li><li><p>考虑迁移到 S3</p></li></ol><h3 id="紧急情况处理" tabindex="-1">紧急情况处理 <a class="header-anchor" href="#紧急情况处理" aria-label="Permalink to &quot;紧急情况处理&quot;">​</a></h3><p><strong>服务无响应</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sealchat</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 二进制</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 终止进程后重启</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>数据库锁定</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查锁定</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlite3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./data/chat.db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.databases&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如有必要，重启服务释放锁</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,35)])])}const b=a(t,[["render",l]]);export{c as __pageData,b as default};
