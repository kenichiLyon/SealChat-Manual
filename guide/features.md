# 功能指南

本指南详细介绍 SealChat 的各项功能和使用方法。

---

## 消息功能

### 发送消息

**基础发送**：
1. 在输入框中输入内容
2. 按 `Enter` 发送

**换行**：
- 按 `Shift + Enter` 在消息中换行

**富文本格式**：

| 格式 | 快捷键 | Markdown 语法 |
|------|--------|---------------|
| **粗体** | `Ctrl + B` | `**文字**` |
| *斜体* | `Ctrl + I` | `*文字*` |
| ~~删除线~~ | - | `~~文字~~` |
| `代码` | `Ctrl + E` | `` `代码` `` |
| 链接 | `Ctrl + K` | `[文字](URL)` |

**代码块**：

输入三个反引号，然后输入语言名称：

```javascript
console.log("Hello");
```

### 编辑消息

1. 鼠标悬停在自己发送的消息上
2. 点击编辑图标（铅笔）
3. 修改内容后按 `Enter` 保存
4. 按 `Escape` 取消编辑

::: info 编辑历史
被编辑的消息会显示"已编辑"标记，点击可查看编辑历史。
:::

### 撤回消息

1. 鼠标悬停在自己发送的消息上
2. 点击删除图标（垃圾桶）
3. 确认撤回

::: warning 注意
- 撤回后其他人无法看到原内容
- 管理员可以恢复撤回的消息
:::

### OOC/IC 标记

**通过界面切换**：
1. 在输入框左侧找到 OOC/IC 切换按钮
2. 选择当前发言模式
3. 发送的消息会带有相应标记

**通过语法标记**：
- OOC 语法：`((内容))` 或 `（（内容））`
- 发送后自动识别为 OOC 消息

**显示效果**：
- IC 消息：正常显示
- OOC 消息：使用不同颜色或样式标识

### 悄悄话

**发送悄悄话**：
1. 点击输入框的悄悄话按钮（眼睛图标）
2. 选择可以看到这条消息的用户
3. 输入内容并发送

**悄悄话显示**：
- 只有发送者和被选中的用户能看到
- 消息会有特殊标记表示这是悄悄话

**使用场景**：
- 主持人给玩家的私密信息
- 角色间的私语对话
- 不公开的骰子结果

### 消息反应

1. 鼠标悬停在消息上
2. 点击表情图标
3. 选择要添加的表情反应

**移除反应**：
- 点击已添加的反应即可移除

---

## 骰子系统

SealChat 内置强大的骰子引擎，支持复杂的骰子表达式。

### 基础骰子命令

在消息中输入骰子命令，发送后自动求值：

| 命令 | 说明 | 示例结果 |
|------|------|----------|
| `.r d20` | 投一个 20 面骰 | 掷骰: d20 = 15 |
| `.r 2d6` | 投两个 6 面骰 | 掷骰: 2d6 = 7 (3+4) |
| `.r d20+5` | 投 d20 加 5 | 掷骰: d20+5 = 18 (13+5) |
| `.r 3d6k2` | 投 3d6 保留最高 2 个 | 掷骰: 3d6k2 = 9 (5+4) |
| `.r 4d6kl3` | 投 4d6 保留最低 3 个 | 掷骰: 4d6kl3 = 6 (1+2+3) |

### 高级骰子表达式

**算术运算**：
```
.r (d20+5)*2
.r d20+d6+3
.r 2d6+1d8-2
```

**保留/丢弃规则**：
- `k` 或 `kh`：保留最高（Keep Highest）
- `kl`：保留最低（Keep Lowest）
- `d` 或 `dl`：丢弃最低（Drop Lowest）
- `dh`：丢弃最高（Drop Highest）

```
.r 4d6dl1    // 投4d6，丢弃最低1个（常用于D&D属性生成）
.r 2d20kh1   // 投2d20，保留最高1个（优势骰）
.r 2d20kl1   // 投2d20，保留最低1个（劣势骰）
```

**重投规则**：
```
.r 4d6r1     // 投4d6，1点重投
.r 4d6ro1    // 投4d6，1点重投一次
```

**爆炸骰**：
```
.r 4d6!      // 投4d6，最大值爆炸（继续投）
.r 4d6!>5    // 投4d6，大于5爆炸
```

### 骰子宏

骰子宏是预定义的骰子表达式，方便快速使用。

**查看可用宏**：
- 在频道设置中查看已配置的骰子宏

**使用宏**：
```
.r 宏名称
.r 攻击骰
.r 伤害骰
```

**创建宏（管理员）**：
1. 进入频道设置
2. 选择"骰子宏管理"
3. 点击"创建宏"
4. 输入宏名称和表达式

**宏示例**：
```yaml
攻击骰: d20+7       # 攻击检定
伤害骰: 2d6+4       # 伤害骰
豁免骰: d20+3       # 豁免检定
先攻骰: d20+2       # 先攻检定
```

### 隐骰

隐骰的结果只有投骰人和主持人能看到。

**使用方法**：
```
.rh d20+5    // 隐骰
```

**显示效果**：
- 其他玩家只能看到"某某进行了一次隐骰"
- 投骰人和主持人可以看到完整结果

**使用场景**：
- 主持人的 NPC 检定
- 需要保密的结果
- 陷阱/感知检定

---

## 身份卡管理

### 创建身份卡

1. 进入频道设置
2. 选择"身份卡管理"
3. 点击"创建身份卡"
4. 填写信息：
   - **昵称**：角色名称
   - **头像**：上传角色图片
   - **描述**：角色简介

### 切换身份卡

**方式一：通过选择器**
1. 在消息输入框旁找到身份卡选择器
2. 点击选择要使用的身份卡

**方式二：通过快捷命令**
```
/id 身份卡名称
```

### 管理身份卡

**编辑**：
1. 进入身份卡管理
2. 点击要编辑的身份卡
3. 修改信息并保存

**删除**：
1. 进入身份卡管理
2. 点击删除按钮
3. 确认删除

**分组（文件夹）**：
1. 创建身份卡文件夹
2. 将身份卡拖入文件夹
3. 便于管理大量身份卡

### 身份卡权限

管理员可以为身份卡设置不同权限：
- 发言权限
- 编辑权限
- 使用骰子权限

---

## 附件与媒体

### 上传附件

**方式一：点击上传**
1. 点击输入框的附件按钮（回形针图标）
2. 选择要上传的文件
3. 等待上传完成
4. 发送消息

**方式二：拖拽上传**
1. 将文件拖拽到聊天区域
2. 松开鼠标上传
3. 发送消息

**方式三：粘贴上传**
1. 复制图片（如截图）
2. 在输入框按 `Ctrl + V`
3. 发送消息

### 支持的文件类型

| 类型 | 格式 | 说明 |
|------|------|------|
| 图片 | JPG, PNG, GIF, WebP | 自动生成缩略图 |
| 音频 | MP3, OGG, WAV, AAC, FLAC | 可在线播放 |
| 视频 | MP4, WebM | 视平台配置 |
| 文档 | PDF, DOC, TXT 等 | 下载查看 |

### 文件大小限制

- 默认单个文件限制：64 MB
- 可在配置文件中调整

### 查看附件

**图片**：
- 点击缩略图查看大图
- 支持放大、缩小、旋转

**音频**：
- 直接在消息中播放
- 支持进度控制

**其他文件**：
- 点击下载到本地

---

## 图库管理

图库用于集中管理和复用图片资源。

### 访问图库

1. 点击输入框的图库按钮（图片图标）
2. 或进入用户设置 → 图库管理

### 上传到图库

1. 打开图库
2. 点击"上传"按钮
3. 选择图片文件
4. 可以添加标签和描述

### 在消息中使用

1. 点击图库按钮
2. 浏览或搜索图片
3. 选择要插入的图片
4. 发送消息

### 图库配额

- 每个用户有图库配额限制
- 默认 100 MB
- 可在配置中调整

### 图库分类

- 支持按标签分类
- 支持按上传时间排序
- 支持搜索图片名称

---

## 音频管理

音频库用于管理音频素材，如背景音乐、音效等。

### 访问音频库

1. 进入用户设置 → 音频库
2. 或在频道中点击音频按钮

### 上传音频

1. 打开音频库
2. 点击"上传"
3. 选择音频文件
4. 填写名称和描述

**支持格式**：
- MP3, OGG, WAV, WebM, AAC, FLAC

**自动转码**：
- 上传后会自动转码为统一格式
- 可配置目标比特率

### 在消息中使用

1. 点击音频按钮
2. 选择音频
3. 发送消息

### 音频播放

- 消息中的音频可直接播放
- 支持暂停、进度调整、音量控制

---

## 消息导出

导出功能可以将聊天记录保存为文件，方便整理和分享。

### 导出入口

1. 进入频道设置
2. 选择"导出消息"
3. 或使用命令 `/export`

### 导出格式

| 格式 | 说明 | 适用场景 |
|------|------|----------|
| **HTML** | 网页格式，保留样式 | 分享、存档、打印 |
| **Markdown** | 纯文本格式 | 文档整理、二次编辑 |

### 导出选项

| 选项 | 说明 |
|------|------|
| 时间范围 | 选择要导出的消息时间段 |
| 包含附件 | 是否将附件嵌入导出文件 |
| 包含 OOC | 是否包含 OOC 消息 |
| 消息数量 | 每页显示的消息数 |

### 导出流程

1. 选择导出参数
2. 点击"开始导出"
3. 等待后台处理
4. 处理完成后下载文件

::: tip 后台处理
大量消息的导出可能需要一些时间。导出任务在后台执行，不影响正常使用。导出完成后会收到通知。
:::

### HTML 导出查看器

导出的 HTML 文件包含独立的查看器：
- 无需联网即可查看
- 保留原始格式和样式
- 支持搜索和导航

---

## 消息搜索

### 基础搜索

1. 点击频道顶部的搜索图标
2. 输入关键词
3. 按 `Enter` 搜索

### 高级搜索

支持多种搜索条件：

| 条件 | 语法 | 说明 |
|------|------|------|
| 关键词 | `魔法` | 搜索包含"魔法"的消息 |
| 发送者 | `from:用户名` | 搜索某用户的消息 |
| 日期 | `after:2024-01-01` | 搜索某日期之后的消息 |
| 日期 | `before:2024-12-31` | 搜索某日期之前的消息 |
| 频道 | `in:频道名` | 搜索特定频道 |

**组合搜索**：
```
from:艾露莎 魔法 after:2024-01-01
```

### 搜索结果

- 结果按时间排序
- 显示匹配消息的上下文
- 点击可跳转到原消息位置

---

## 好友系统

### 添加好友

**方式一：通过用户名**
1. 进入用户设置 → 好友
2. 点击"添加好友"
3. 输入对方用户名
4. 发送好友请求

**方式二：通过世界成员**
1. 在世界成员列表中找到用户
2. 点击用户头像
3. 选择"添加好友"

### 处理好友请求

1. 进入用户设置 → 好友请求
2. 查看收到的请求
3. 选择接受或拒绝

### 私聊

添加好友后：
1. 在好友列表中点击好友
2. 打开私聊窗口
3. 发送私密消息

### 删除好友

1. 进入好友列表
2. 点击好友旁的设置
3. 选择"删除好友"

---

## iForm 表单

iForm 是嵌入频道的交互表单，用于收集信息。

### 查看表单

- 表单显示在频道顶部或消息流中
- 点击可以填写和提交

### 创建表单（管理员）

1. 进入频道设置
2. 选择"iForm 管理"
3. 点击"创建表单"
4. 添加字段：
   - 文本框
   - 单选
   - 多选
   - 日期
   - 数字

### 表单用途

- 角色信息收集
- 投票调查
- 签到统计
- 规则确认

---

## 便签功能

便签是固定在频道顶部的公告区域。

### 查看便签

- 便签显示在频道消息列表上方
- 所有成员都可以看到

### 编辑便签（管理员）

1. 点击便签区域的编辑按钮
2. 输入或修改内容
3. 支持富文本格式
4. 保存

### 便签用途

- 频道规则说明
- 重要公告
- 常用信息汇总
- 链接收集

---

## 通知设置

### 邮件通知

如果服务器配置了邮件功能：

1. 进入用户设置 → 通知
2. 填写接收通知的邮箱
3. 配置通知频率

**通知类型**：
- 未读消息通知
- @提及通知
- 好友请求通知

### 通知延迟

- 可配置最小延迟（避免频繁打扰）
- 可配置每小时最大通知数

### 免打扰

- 可以为特定频道设置免打扰
- 静音后不会收到该频道的通知

---

## 快捷键汇总

| 快捷键 | 功能 |
|--------|------|
| `Enter` | 发送消息 |
| `Shift + Enter` | 消息内换行 |
| `Ctrl + B` | 粗体 |
| `Ctrl + I` | 斜体 |
| `Ctrl + K` | 插入链接 |
| `Ctrl + E` | 行内代码 |
| `Ctrl + Z` | 撤销 |
| `Ctrl + Y` | 重做 |
| `Escape` | 取消编辑 |
| `↑` (输入框为空) | 编辑上一条消息 |
